# 语音回拨
<!-- toc -->

# 语音回拨发起

用户应用调用该接口后， [oneyun.com](http://oneyun.com/) 首先向第一个被叫方发起呼叫；在第一方接听后，向二方放发起呼叫；第二方接听后，双方通话。期间任何一方挂机，就结束语音回拨过程。

被叫的双方不能是同一个号码。

## 请求

### URL

```
POST {BASE_URL}/call/duo_callback
```

### 请求参数列表

| 参数                    | 有效值范围       | 是否必填                | 说明                                       |
| --------------------- | ----------- | ------------------- | ---------------------------------------- |
| `from1`               | 电话号码字符串     | 选填，默认为`使用系统主叫`      | 向第一方显示的来电号码。                             |
| `to1`                 | 电话号码字符串     | **必填 **             | 第一方的被叫号码。                                |
| `from2`               | 电话号码字符串     | 选填，默认为`使用系统主叫`      | 向第二方显示的来电号码。                             |
| `to2`                 | 电话号码字符串     | **必填 **             | 第二方的被叫号码。                                |
| `ring_tone`           | 录音文件名字符串    | 选填，默认`null`，无自定义回铃音 | 自定义回铃音文件，再向第二方拨号的时候，向第一方播放这个文件。如果不指定该参数或者该参数为空，则向第一方透传播放第二方的回铃音。 |
| `ring_tone_mode`      | 枚举          | 选填，默认`3`            | 自定义回铃音播放模式。参见[自定义回铃音播放模式列表](#自定义回铃音播放模式列表) 。      |
| `max_dial_duration`   | 正整数         | 选填，默认`45`           | 最大拨号等待时长（秒）。系统再拨号进行该时长后，仍然没有被接听，则中断拨号过程，做超时错误处理。 |
| `max_call_duration`   | 正整数         | **必填 **             | 最大通话时长（秒）。双方通话的最大时长。超过该时长，系统将挂断。         |
| `recording` **尚未开放**  | 布尔值         | 选填，默认`false`        | 是否录音。true录音，false不录音。                    |
| `record_mode`**尚未开放** | 枚举          | 选填，默认`0`            | 录音模式。参见[录音模式列表](#录音模式列表)。                  |
| `user_data`           | 不超过128字符字符串 | 选填，默认`null` ，无用户数据  | 用户数据，该呼叫的后续事件将带有该参数。                     |

### 参数详解

#### 自定义回铃音播放模式列表 

| 枚举值  | 说明                                       |
| ---- | ---------------------------------------- |
| `0`  | 收到对端回铃后开始播放。如果回铃音文件为空，则不播放，直接拨号，且透传回铃音。  |
| `1`  | (未实现，不要使用) 拨号时即开始播放，收到对端回铃后停止播放，并透传回铃音。如果回铃音文件为空，则不播放，直接拨号，且透传回铃音。 |
| `2`  | 拨号时即开始播放，对端接听或者挂机后停止播放。如果回铃音文件为空，则不播放，直接拨号，且透传回铃音。 |
| `3`  | 拨号之前播放回铃音文件，播放完毕后再拨号，拨号时透传对方的回铃音。如果回铃音文件为空，则不播放，直接拨号，且透传回铃音。 |

####录音模式列表

| 枚举值  | 说明           |
| ---- | ------------ |
| `0`  | 双向接通后录音      |
| `1`  | 开始呼叫第一方时启动录音 |
| `2`  | 开始呼叫第二方时启动录音 |

## 响应

### 响应参数列表

| 参数     | 有效值范围   | 说明                            |
| ------ | ------- | ----------------------------- |
| `code` | 数字文本    | 状态码，全0表示正确                    |
| `msg`  | 文本      | 返回情况说明                        |
| `data` | JSON 对象 | 返回数据对象，参见[data对象属性列表](#data对象属性列表)|

### 参数详解

#### data对象属性列表

| 属性       | 有效值范围        | 说明       |
| -------- | ------------ | -------- |
| `callId` | UUID HEX 字符串 | 此次呼叫的 ID |

## 事件

见 [语音回拨事件](../evt/simple_call/duo_callback.md)一节

## 示例

请求:
```http
POST {BASE_URL}/account/{account_id}/call/duo_callback HTTP/1.1
Host: api.yunhuni.com
Content-Type: application/json
Accept-Type: application/json
Content-Length: xxx

{
  "from1": "075589877675",
  "from2": "075589877675",
  "to1": "13967446745",
  "to2": "13009347583",
  "max_call_duration": 3600
}
```

响应:
```http
HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: xxx

{
  "code": "000000",
  "msg": "请求成功",
  "data": {
    "callId": "2e2597d4849211e681c7803f5d09b29d"
  }
}
```

# 语音回拨挂断
用户应用调用该接口后， [oneyun.com](http://oneyun.com/) 首先向第一个被叫方发起呼叫；在第一方接听后，向二方放发起呼叫；第二方接听后，双方通话。

期间用户可通过调用语音回拨接口挂断接口，主动结束语音回拨。

## 请求

### URL

```
POST {BASE_URL}/call/duo_callback_cancel
```

### 请求参数列表

| 参数       | 有效值范围        | 是否必填   | 说明                  |
| -------- | ------------ | ------ | ------------------- |
| `callId` | UUID HEX 字符串 | **必填** | 欲挂断的语音回拨返回的`呼叫的 ID` |



## 响应

### 响应参数列表

| 参数     | 有效值范围   | 说明                            |
| ------ | ------- | ----------------------------- |
| `code` | 数字文本    | 状态码，全0表示正确                    |
| `msg`  | 文本      | 返回情况说明                        |
| `data` | JSON 对象 | 返回数据对象，参见[data对象属性列表](#data对象属性列表)|

### 参数详解
    
#### data对象属性列表

| 属性       | 有效值范围        | 说明       |
| -------- | ------------ | -------- |
| `callId` | UUID HEX 字符串 | 此次呼叫的 ID |

## 事件

见 [语音回拨事件](../evt/simple_call/duo_callback.md)一节

## 举例

请求:
```http
POST {BASE_URL}/call/duo_callback HTTP/1.1
Host: api.yunhuni.com
Content-Type: application/json
Accept-Type: application/json
Content-Length: xxx

{
  "callId": "2e2597d4849211e681c7803f5d09b29d"
}
```

响应:
```http
HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: xxx

{
  "code": "000000",
  "msg": "请求成功",
  "data": {
    "callId": "2e2597d4849211e681c7803f5d09b29d"
  }
}
```

